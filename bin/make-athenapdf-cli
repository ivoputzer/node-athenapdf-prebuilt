#!/usr/bin/env sh

set -e

# gitmodules
echo "Downloading git modules... $(pwd)"

git config -f .gitmodules --get-regex submodule.*url \
| sed 's/submodule.//g;s/.url//g' \
| awk '{print $2,$1}' \
| xargs -n 2 git clone --progress --verbose --recursive \
| sh

echo "Initializing athenapdf-cli... $(pwd)"
athenapdf='lib/athenapdf/cli'
(
  cd $athenapdf
  echo "Switching directories... $(pwd)"
  npm install
  npm run build
  npm link
) && npm link $athenapdf
