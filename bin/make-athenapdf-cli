#!/usr/bin/env sh

set -e
echo "Downloading git modules... $(pwd)"
git config -f .gitmodules --get-regex submodule.*url \
| sed 's/submodule.//g;s/.url//g' \
| awk '{print $2,$1}' \
| xargs -n 2 git clone --progress --verbose --recursive \
| sh
(
  echo "Switching directories... $(pwd)"
  cd lib/athenapdf/cli
  echo "Installing package... $(pwd)"
  npm install
  echo "Building package... $(pwd)"
  npm run build
  echo "Linking package... $(pwd)"
  npm link
) && npm link athenapdf
echo "Done. $(pwd)"
